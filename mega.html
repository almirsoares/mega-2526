<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Conferidor Mega Sena</title>
    <style>
        :root {
            --bg-color: #121212;
            --card-bg: #1e1e1e;
            --text-color: #e0e0e0;
            --text-secondary: #aaa;
            --header-bg: #2c2c2c;
            --input-bg: #333;
            --border-color: #444;
            --quadra: #ff9800;
            --quina: #9c27b0;
            --sena: #00e676;
            --ball-bg: #333;
            --ball-text: #fff;
            --ball-match: #fdd835;
            --ball-match-text: #000;
            --shadow: rgba(0,0,0,0.5);
        }

        body.light-theme {
            --bg-color: #f0f2f5;
            --card-bg: #ffffff;
            --text-color: #1c1e21;
            --text-secondary: #65676b;
            --header-bg: #ffffff;
            --input-bg: #f0f2f5;
            --border-color: #ccc;
            --ball-bg: #e4e6eb;
            --ball-text: #050505;
            --shadow: rgba(0,0,0,0.1);
        }

        body {
            font-family: sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding-bottom: 50px;
            transition: 0.3s;
        }

        header {
            background-color: var(--header-bg);
            padding: 15px;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 10px var(--shadow);
            border-bottom: 1px solid var(--border-color);
        }

        .header-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        h1 { margin: 0; font-size: 1.1rem; }

        #theme-toggle {
            background: none;
            border: 1px solid var(--border-color);
            color: var(--text-color);
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
        }

        .input-group { display: flex; gap: 10px; }

        input[type="number"] {
            flex: 1;
            padding: 12px;
            font-size: 1.2rem;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            background: var(--input-bg);
            color: var(--text-color);
            text-align: center;
        }

        .add-btn {
            background-color: var(--sena);
            color: #000;
            border: none;
            padding: 0 25px;
            border-radius: 8px;
            font-weight: bold;
            font-size: 1.5rem;
        }

        #drawn-numbers-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 15px;
            justify-content: center;
        }

        .drawn-ball {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--ball-match);
            color: var(--ball-match-text);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            cursor: pointer;
        }

        /* --- Estatísticas --- */
        .frequency-section {
            background: var(--card-bg);
            margin: 15px;
            padding: 12px;
            border-radius: 10px;
            font-size: 0.85rem;
            border: 1px solid var(--border-color);
        }
        .freq-title { font-weight: bold; margin-bottom: 8px; display: block; border-bottom: 1px solid var(--border-color); padding-bottom: 4px; }
        .freq-list { display: flex; flex-wrap: wrap; gap: 10px; }
        .freq-item { color: var(--text-secondary); }
        .freq-item b { color: var(--sena); }

        .stats-bar { text-align: center; font-size: 0.85rem; color: var(--text-secondary); margin-top: 10px; }

        #games-list { padding: 15px; display: flex; flex-direction: column; gap: 12px; }

        .game-card {
            background-color: var(--card-bg);
            padding: 15px;
            border-radius: 10px;
            border-left: 5px solid var(--border-color);
            box-shadow: 0 2px 5px var(--shadow);
        }

        .game-header { display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 0.9rem; }

        .game-numbers { display: flex; flex-wrap: wrap; gap: 8px; }

        .ball {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background-color: var(--ball-bg);
            color: var(--ball-text);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.85rem;
        }

        .ball.hit {
            background-color: var(--ball-match);
            color: var(--ball-match-text);
            font-weight: bold;
            transform: scale(1.1);
        }

        .win-4 { border-left-color: var(--quadra); background: rgba(255,152,0,0.05); }
        .win-5 { border-left-color: var(--quina); background: rgba(156,39,176,0.05); }
        .win-6 { border-left-color: var(--sena); background: rgba(0,230,118,0.05); }

        .badge { padding: 2px 6px; border-radius: 4px; color: #fff; font-weight: bold; font-size: 0.7rem; display: none; }
        .win-4 .badge { display: inline; background: var(--quadra); }
        .win-5 .badge { display: inline; background: var(--quina); }
        .win-6 .badge { display: inline; background: var(--sena); }

        #error-msg { color: #ff5252; padding: 20px; text-align: center; display: none; }
        #alert-box { background: #ff980022; color: #ff9800; padding: 10px; margin: 15px; border-radius: 8px; border: 1px solid #ff9800; display: none; font-size: 0.85rem; }
    </style>
</head>
<body>

<header>
    <div class="header-top">
        <h1>Mega Sena Live</h1>
        <button id="theme-toggle">☀ Tema</button>
    </div>
    
    <div class="input-group">
        <input type="number" id="numInput" placeholder="Nº Sorteado" inputmode="numeric">
        <button class="add-btn" id="addBtn">+</button>
    </div>
    
    <div id="drawn-numbers-container"></div>
    <div class="stats-bar" id="stats-info">Iniciando...</div>
</header>

<main>
    <div id="error-msg"></div>
    <div id="alert-box"></div>

    <section class="frequency-section" id="freq-section" style="display:none;">
        <span class="freq-title">Números mais jogados (Top 10):</span>
        <div class="freq-list" id="freq-list"></div>
    </section>

    <div id="games-list"></div>
</main>

<script>
    let games = [];
    let drawnNumbers = [];

    function toggleTheme() {
        document.body.classList.toggle('light-theme');
        const isLight = document.body.classList.contains('light-theme');
        document.getElementById('theme-toggle').textContent = isLight ? '☾ Escuro' : '☀ Claro';
        localStorage.setItem('mega-theme', isLight ? 'light' : 'dark');
    }

    function renderDrawnNumbers() {
        const container = document.getElementById('drawn-numbers-container');
        container.innerHTML = '';
        drawnNumbers.forEach(num => {
            const el = document.createElement('div');
            el.className = 'drawn-ball';
            el.textContent = num < 10 ? '0'+num : num;
            el.onclick = () => {
                drawnNumbers = drawnNumbers.filter(n => n !== num);
                updateUI();
            };
            container.appendChild(el);
        });
    }

    // --- NOVA FUNÇÃO: FREQUÊNCIA ---
    function updateFrequency() {
        const freqMap = {};
        games.forEach(game => {
            game.numbers.forEach(n => {
                freqMap[n] = (freqMap[n] || 0) + 1;
            });
        });

        const sortedFreq = Object.entries(freqMap)
            .sort((a, b) => b[1] - a[1])
            .slice(0, 10);

        const freqContainer = document.getElementById('freq-list');
        const freqSection = document.getElementById('freq-section');
        
        if (sortedFreq.length > 0) {
            freqSection.style.display = 'block';
            freqContainer.innerHTML = sortedFreq.map(([num, count]) => 
                `<span class="freq-item">Nº <b>${num < 10 ? '0'+num : num}</b>: ${count}x</span>`
            ).join('');
        }
    }

    function renderGames() {
        const list = document.getElementById('games-list');
        list.innerHTML = '';

        games.forEach(game => {
            let winClass = '';
            let badgeTxt = '';
            if (game.hits >= 6) { winClass = 'win-6'; badgeTxt = 'SENA'; }
            else if (game.hits === 5) { winClass = 'win-5'; badgeTxt = 'QUINA'; }
            else if (game.hits === 4) { winClass = 'win-4'; badgeTxt = 'QUADRA'; }

            const ballsHtml = game.numbers.map(n => {
                const isHit = drawnNumbers.includes(n);
                return `<div class="ball ${isHit ? 'hit' : ''}">${n < 10 ? '0'+n : n}</div>`;
            }).join('');

            const html = `
                <div class="game-card ${winClass}">
                    <div class="game-header">
                        <strong>Jogo #${game.id}</strong>
                        <span class="badge">${badgeTxt}</span>
                        <span>Acertos: <b>${game.hits}</b></span>
                    </div>
                    <div class="game-numbers">${ballsHtml}</div>
                </div>`;
            list.insertAdjacentHTML('beforeend', html);
        });
    }

    function updateUI() {
        games.forEach(g => g.hits = g.numbers.filter(n => drawnNumbers.includes(n)).length);
        games.sort((a, b) => b.hits - a.hits);
        
        const w4 = games.filter(g => g.hits === 4).length;
        const w5 = games.filter(g => g.hits === 5).length;
        const w6 = games.filter(g => g.hits >= 6).length;

        document.getElementById('stats-info').textContent = 
            `Jogos: ${games.length} | Quadras: ${w4} | Quinas: ${w5} | Senas: ${w6}`;
        
        renderDrawnNumbers();
        renderGames();
    }

    function addNumber() {
        const input = document.getElementById('numInput');
        const val = parseInt(input.value);
        if (val >= 1 && val <= 60 && !drawnNumbers.includes(val)) {
            drawnNumbers.push(val);
            input.value = '';
            updateUI();
        }
        input.focus();
    }

    async function loadCSV() {
        try {
            const resp = await fetch('./jogos.csv?v=' + Date.now());
            if (!resp.ok) throw new Error();
            const text = await resp.text();
            
            const lines = text.split('\n');
            let startIndex = (lines[0].toLowerCase().includes('jogador')) ? 1 : 0;
            
            games = [];
            const seenGames = {};
            const duplicates = [];

            for (let i = startIndex; i < lines.length; i++) {
                const cols = lines[i].split(',');
                if (cols.length < 3) continue;
                
                const nums = cols.slice(2)
                    .map(n => parseInt(n.trim()))
                    .filter(n => !isNaN(n))
                    .sort((a, b) => a - b); // Ordena para comparar duplicados corretamente

                if (nums.length > 0) {
                    const gameKey = nums.join('-');
                    const gameId = games.length + 1;
                    
                    if (seenGames[gameKey]) {
                        duplicates.push(`Jogo #${gameId} é igual ao Jogo #${seenGames[gameKey]}`);
                    } else {
                        seenGames[gameKey] = gameId;
                    }

                    games.push({ id: gameId, numbers: nums, hits: 0 });
                }
            }

            // --- ALERTA DE DUPLICADOS ---
            if (duplicates.length > 0) {
                const alertBox = document.getElementById('alert-box');
                alertBox.style.display = 'block';
                alertBox.innerHTML = `<strong>Atenção: Jogos Repetidos Detectados!</strong><br>${duplicates.slice(0, 3).join('<br>')}${duplicates.length > 3 ? '<br>...' : ''}`;
            }

            document.getElementById('stats-info').textContent = `Pronto: ${games.length} jogos.`;
            updateFrequency();
            renderGames();
        } catch (e) {
            document.getElementById('error-msg').style.display = 'block';
            document.getElementById('error-msg').innerHTML = "<b>Erro ao carregar jogos.csv</b>";
        }
    }

    document.addEventListener('DOMContentLoaded', () => {
        document.getElementById('theme-toggle').addEventListener('click', toggleTheme);
        document.getElementById('addBtn').addEventListener('click', addNumber);
        document.getElementById('numInput').addEventListener('keypress', (e) => { if(e.key === 'Enter') addNumber(); });
        if (localStorage.getItem('mega-theme') === 'light') toggleTheme();
        loadCSV();
    });
</script>
</body>
</html>
